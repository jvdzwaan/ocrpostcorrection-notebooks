schema: '2.0'
stages:
  data-split:
    cmd: python src/stages/data-split.py --config params.yaml
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: src/stages/data-split.py
      md5: 84883bb36ac963fea60ce1947c692d71
      size: 1355
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        data-split:
          val-size: 0.1
          train-split: data/splits/train.csv
          val-split: data/splits/val.csv
          test-split: data/splits/test.csv
    outs:
    - path: data/splits/test.csv
      md5: e7ddfb949902c81b7ee76971295b3688
      size: 151272
    - path: data/splits/train.csv
      md5: 135ea87880a8dd2f69684c9a5a9466dc
      size: 532103
    - path: data/splits/val.csv
      md5: c74421cede23176eed7e7323ee7f9961
      size: 59369
  create-error-detection-dataset:
    cmd: python src/stages/create-error-detection-dataset.py --config params.yaml
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: data/splits/test.csv
      md5: e7ddfb949902c81b7ee76971295b3688
      size: 151272
    - path: data/splits/train.csv
      md5: 135ea87880a8dd2f69684c9a5a9466dc
      size: 532103
    - path: data/splits/val.csv
      md5: c74421cede23176eed7e7323ee7f9961
      size: 59369
    - path: src/stages/create-error-detection-dataset.py
      md5: 71bcecd7f786dda1e8a30f51377e6d54
      size: 2738
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
    outs:
    - path: data/processed/detection-dataset
      md5: a1383bc7cad91b4632ca06e1a45b37de.dir
      size: 77549763
      nfiles: 10
  train-error-detection:
    cmd: python src/stages/train-error-detection.py --config params.yaml
    deps:
    - path: data/processed/detection-dataset
      md5: a1383bc7cad91b4632ca06e1a45b37de.dir
      size: 77549763
      nfiles: 10
    - path: src/stages/train-error-detection.py
      md5: 38fac49446a37bcf488710d9eb492d24
      size: 3958
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
        train-error-detection:
          pretrained-model-name: bert-base-multilingual-cased
          output-dir: models/error-detection/
          evaluation-strategy: epoch
          num-train-epochs: 3
          load-best-model-at-end: true
          save-strategy: epoch
          per-device-train-batch-size: 16
          train-log: results/detection/logs/train-log.csv
          delete-checkpoints: true
    outs:
    - path: models/error-detection/
      md5: 9011ab45e489e833da3be6572abbca28.dir
      size: 713052764
      nfiles: 7
    - path: results/detection/logs/train-log.csv
      md5: 38daee3e382c8519eefd81e912ccf89b
      size: 1088
