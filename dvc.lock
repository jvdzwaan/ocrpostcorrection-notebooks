schema: '2.0'
stages:
  data-split:
    cmd: python src/stages/data-split.py --config params.yaml
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: src/stages/data-split.py
      md5: 84883bb36ac963fea60ce1947c692d71
      size: 1355
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        data-split:
          val-size: 0.1
          train-split: data/splits/train.csv
          val-split: data/splits/val.csv
          test-split: data/splits/test.csv
    outs:
    - path: data/splits/test.csv
      md5: e7ddfb949902c81b7ee76971295b3688
      size: 151272
    - path: data/splits/train.csv
      md5: 135ea87880a8dd2f69684c9a5a9466dc
      size: 532103
    - path: data/splits/val.csv
      md5: c74421cede23176eed7e7323ee7f9961
      size: 59369
  create-error-detection-dataset:
    cmd: python src/stages/create-error-detection-dataset.py --config params.yaml
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: data/splits/test.csv
      md5: e7ddfb949902c81b7ee76971295b3688
      size: 151272
    - path: data/splits/train.csv
      md5: 135ea87880a8dd2f69684c9a5a9466dc
      size: 532103
    - path: data/splits/val.csv
      md5: c74421cede23176eed7e7323ee7f9961
      size: 59369
    - path: src/stages/create-error-detection-dataset.py
      md5: 71bcecd7f786dda1e8a30f51377e6d54
      size: 2738
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
    outs:
    - path: data/processed/detection-dataset
      md5: a1383bc7cad91b4632ca06e1a45b37de.dir
      size: 77549763
      nfiles: 10
  train-error-detection:
    cmd: python src/stages/train-error-detection.py --config params.yaml
    deps:
    - path: data/processed/detection-dataset
      md5: a1383bc7cad91b4632ca06e1a45b37de.dir
      size: 77549763
      nfiles: 10
    - path: src/stages/train-error-detection.py
      md5: 38fac49446a37bcf488710d9eb492d24
      size: 3958
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
        train-error-detection:
          pretrained-model-name: bert-base-multilingual-cased
          output-dir: models/error-detection/
          evaluation-strategy: epoch
          num-train-epochs: 3
          load-best-model-at-end: true
          save-strategy: epoch
          per-device-train-batch-size: 16
          train-log: results/detection/logs/train-log.csv
          delete-checkpoints: true
    outs:
    - path: models/error-detection/
      md5: 9011ab45e489e833da3be6572abbca28.dir
      size: 713052764
      nfiles: 7
    - path: results/detection/logs/train-log.csv
      md5: 38daee3e382c8519eefd81e912ccf89b
      size: 1088
  evaluate-error-detection:
    cmd: python src/stages/evaluate-error-detection.py --config params.yaml
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: results/detection/icdar_predictions.json
      md5: 214bcd8898bdccd86d6b9a5e6b68d3c6
      size: 5231392
    - path: src/stages/evaluate-error-detection.py
      md5: 9840bbd524892a2ecda567c0b278d813
      size: 1016
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        convert-predictions-to-icdar-output:
          icdar-output-json: results/detection/icdar_predictions.json
        evaluate-error-detection:
          icdar-output-csv: results/detection/icdar_evaluation_results.csv
        predict-test-set-error-detection:
          per-device-eval-batch-size: 16
          test-log: results/detection/logs/test-log.csv
          predictions: results/detection/predictions.npy
    outs:
    - path: results/detection/icdar_evaluation_results.csv
      md5: cd35e95f3360d3411f20924af9262a24
      size: 158455
  predict-test-set-error-detection:
    cmd: python src/stages/predict-test-set-error-detection.py --config params.yaml
    deps:
    - path: data/processed/detection-dataset
      md5: a1383bc7cad91b4632ca06e1a45b37de.dir
      size: 77549763
      nfiles: 10
    - path: models/error-detection/
      md5: 9011ab45e489e833da3be6572abbca28.dir
      size: 713052764
      nfiles: 7
    - path: src/stages/predict-test-set-error-detection.py
      md5: c2f49ae8c643c94baf0bd101d0e0a461
      size: 2986
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
        predict-test-set-error-detection:
          per-device-eval-batch-size: 16
          test-log: results/detection/logs/test-log.csv
          predictions: results/detection/predictions.npy
        train-error-detection:
          pretrained-model-name: bert-base-multilingual-cased
          output-dir: models/error-detection/
          evaluation-strategy: epoch
          num-train-epochs: 3
          load-best-model-at-end: true
          save-strategy: epoch
          per-device-train-batch-size: 16
          train-log: results/detection/logs/train-log.csv
          delete-checkpoints: true
    outs:
    - path: results/detection/logs/test-log.csv
      md5: 14f0032632d051414f75439a6a51faea
      size: 95
    - path: results/detection/predictions.npy
      md5: bd5e29ea68cd470e39845ee73482b8ee
      size: 78632336
  generate-error-detection-report:
    cmd: python src/stages/generate-error-detection-report.py --config params.yaml
    deps:
    - path: results/detection/icdar_evaluation_results.csv
      md5: cd35e95f3360d3411f20924af9262a24
      size: 158455
    - path: results/detection/logs/test-log.csv
      md5: 14f0032632d051414f75439a6a51faea
      size: 95
    - path: results/detection/logs/train-log.csv
      md5: 38daee3e382c8519eefd81e912ccf89b
      size: 1088
    - path: src/stages/generate-error-detection-report.py
      md5: 9721c57fc0a83d3336218eea950db930
      size: 2721
    - path: templates/report-error-detection.md
      md5: a6f392d6f73022cf9ef9b35dfa600b74
      size: 633
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
        data-split:
          val-size: 0.1
          train-split: data/splits/train.csv
          val-split: data/splits/val.csv
          test-split: data/splits/test.csv
        evaluate-error-detection:
          icdar-output-csv: results/detection/icdar_evaluation_results.csv
        predict-test-set-error-detection:
          per-device-eval-batch-size: 16
          test-log: results/detection/logs/test-log.csv
          predictions: results/detection/predictions.npy
        train-error-detection:
          pretrained-model-name: bert-base-multilingual-cased
          output-dir: models/error-detection/
          evaluation-strategy: epoch
          num-train-epochs: 3
          load-best-model-at-end: true
          save-strategy: epoch
          per-device-train-batch-size: 16
          train-log: results/detection/logs/train-log.csv
          delete-checkpoints: true
    outs:
    - path: reports/detection/experiment_results.md
      md5: fa333de08b827c4d9fc4b455d23b1c71
      size: 1520
    - path: reports/detection/metrics.json
      md5: 3b2f7bbcb65eae8ad7316d8c1108da88
      size: 353
  convert-predictions-to-icdar-output:
    cmd: python src/stages/convert-predictions-to-icdar-output.py --config params.yaml
    deps:
    - path: data/processed/detection-dataset
      md5: a1383bc7cad91b4632ca06e1a45b37de.dir
      size: 77549763
      nfiles: 10
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: results/detection/predictions.npy
      md5: bd5e29ea68cd470e39845ee73482b8ee
      size: 78632336
    - path: src/stages/convert-predictions-to-icdar-output.py
      md5: bf628478304b9fb7c3163f3425eef0bf
      size: 1958
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        convert-predictions-to-icdar-output:
          icdar-output-json: results/detection/icdar_predictions.json
        predict-test-set-error-detection:
          per-device-eval-batch-size: 16
          test-log: results/detection/logs/test-log.csv
          predictions: results/detection/predictions.npy
        train-error-detection:
          pretrained-model-name: bert-base-multilingual-cased
          output-dir: models/error-detection/
          evaluation-strategy: epoch
          num-train-epochs: 3
          load-best-model-at-end: true
          save-strategy: epoch
          per-device-train-batch-size: 16
          train-log: results/detection/logs/train-log.csv
          delete-checkpoints: true
    outs:
    - path: results/detection/icdar_predictions.json
      md5: 214bcd8898bdccd86d6b9a5e6b68d3c6
      size: 5231392
