schema: '2.0'
stages:
  data-split:
    cmd: "python src/stages/data-split.py --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip\
      \ --train-split data/splits/train.csv --val-split data/splits/val.csv --test-split\
      \ data/splits/test.csv --val-size 0.1 --seed 8232\n"
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: src/stages/data-split.py
      md5: 2a0bbe5100db9f5acefd41f5bd823aeb
      size: 1235
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        data-split:
          val-size: 0.1
          train-split: data/splits/train.csv
          val-split: data/splits/val.csv
          test-split: data/splits/test.csv
    outs:
    - path: data/splits/test.csv
      md5: 12b4e9253147e46207a934aa0988e15e
      size: 163439
    - path: data/splits/train.csv
      md5: 4e3d17d9ef2abdf7debb09b7184d19f1
      size: 574230
    - path: data/splits/val.csv
      md5: 481d6c2885fa9f6aa7805c0100cb32e6
      size: 63904
  create-error-detection-dataset:
    cmd: "python src/stages/create-error-detection-dataset.py --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip\
      \ --train-split data/splits/train.csv --val-split data/splits/val.csv --test-split\
      \ data/splits/test.csv --size 35 --step 30 --max-ed 0.3 --dataset-out data/processed/detection-dataset\n"
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: data/splits/test.csv
      md5: 12b4e9253147e46207a934aa0988e15e
      size: 163439
    - path: data/splits/train.csv
      md5: 4e3d17d9ef2abdf7debb09b7184d19f1
      size: 574230
    - path: data/splits/val.csv
      md5: 481d6c2885fa9f6aa7805c0100cb32e6
      size: 63904
    - path: src/stages/create-error-detection-dataset.py
      md5: 0091e4f12b62dfe8e3883cf6cdcbb126
      size: 2567
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
        data-split:
          val-size: 0.1
          train-split: data/splits/train.csv
          val-split: data/splits/val.csv
          test-split: data/splits/test.csv
    outs:
    - path: data/processed/detection-dataset
      md5: 649d31b769a41e287af7e069efcf8f54.dir
      size: 77550059
      nfiles: 10
  train-error-detection:
    cmd: "python src/stages/train-error-detection.py --seed 8232 --dataset-in data/processed/detection-dataset\
      \ --model-name bert-base-multilingual-cased --evaluation-strategy epoch --per-device-train-batch-size\
      \ 16 --num-train-epochs 3 --load-best-model-at-end --save-strategy epoch --delete-checkpoints\
      \ --model-dir models/error-detection/ --train-log results/detection/logs/train-log.csv\n"
    deps:
    - path: data/processed/detection-dataset
      md5: 649d31b769a41e287af7e069efcf8f54.dir
      size: 77550059
      nfiles: 10
    - path: src/stages/train-error-detection.py
      md5: e998c7aec7d6c0427008ef3c0e3d8cb5
      size: 2595
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
        train-error-detection:
          pretrained-model-name: bert-base-multilingual-cased
          output-dir: models/error-detection/
          evaluation-strategy: epoch
          num-train-epochs: 3
          save-strategy: epoch
          per-device-train-batch-size: 16
          train-log: results/detection/logs/train-log.csv
    outs:
    - path: models/error-detection/
      md5: 54f78571a490134d33ca4d78caeaed59.dir
      size: 713052828
      nfiles: 7
    - path: results/detection/logs/train-log.csv
      md5: 870584cbeb118e8c2abcfc494bf7e8eb
      size: 1092
  evaluate-error-detection:
    cmd: "python src/stages/run-icdar-evaluation.py --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip\
      \ --json-file results/detection/icdar_predictions.json --csv-file results/detection/icdar_evaluation_results.csv\n"
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: results/detection/icdar_predictions.json
      md5: 1f1295ece1c46384f92aaa6fe1de2c7e
      size: 5172170
    - path: src/stages/run-icdar-evaluation.py
      md5: 79deffa29b79f17f0ea4033a27a3a352
      size: 754
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        convert-error-detection-predictions-to-icdar-output:
          icdar-output-json: results/detection/icdar_predictions.json
        evaluate-error-detection:
          icdar-output-csv: results/detection/icdar_evaluation_results.csv
    outs:
    - path: results/detection/icdar_evaluation_results.csv
      md5: 371e01991c16a6118efe15c2242fc2f2
      size: 158502
  predict-test-set-error-detection:
    cmd: "python src/stages/predict-test-set-error-detection.py --seed 8232 --dataset-in\
      \ data/processed/detection-dataset --model-dir models/error-detection/ --model-name\
      \ bert-base-multilingual-cased --evaluation-strategy epoch --eval-batch-size\
      \ 16 --num-train-epochs 3 --predictions-out results/detection/predictions.npy\
      \ --test-log results/detection/logs/test-log.csv\n"
    deps:
    - path: data/processed/detection-dataset
      md5: 649d31b769a41e287af7e069efcf8f54.dir
      size: 77550059
      nfiles: 10
    - path: models/error-detection/
      md5: 54f78571a490134d33ca4d78caeaed59.dir
      size: 713052828
      nfiles: 7
    - path: src/stages/predict-test-set-error-detection.py
      md5: 04a24f995366bf12b767c64fc1658a47
      size: 2673
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
        predict-test-set-error-detection:
          per-device-eval-batch-size: 16
          test-log: results/detection/logs/test-log.csv
          predictions: results/detection/predictions.npy
        train-error-detection:
          pretrained-model-name: bert-base-multilingual-cased
          output-dir: models/error-detection/
          evaluation-strategy: epoch
          num-train-epochs: 3
          save-strategy: epoch
          per-device-train-batch-size: 16
          train-log: results/detection/logs/train-log.csv
    outs:
    - path: results/detection/logs/test-log.csv
      md5: 38e0a8d9b1a7f72526cb40894cf347be
      size: 96
    - path: results/detection/predictions.npy
      md5: f3b134a9149b2205687ac3e13737d732
      size: 78632336
  generate-error-detection-report:
    cmd: "python src/stages/generate-error-detection-report.py --evaluation-csv results/detection/icdar_evaluation_results.csv\
      \ --train-log-file results/detection/logs/train-log.csv --test-log-file results/detection/logs/test-log.csv\
      \ --seed 8232 --val-size 0.1 --max-ed 0.3 --size 35 --step 30 --model-name bert-base-multilingual-cased\
      \ --metrics-file reports/detection/metrics.json --report-file reports/detection/experiment_results.md\n"
    deps:
    - path: results/detection/icdar_evaluation_results.csv
      md5: 371e01991c16a6118efe15c2242fc2f2
      size: 158502
    - path: results/detection/logs/test-log.csv
      md5: 38e0a8d9b1a7f72526cb40894cf347be
      size: 96
    - path: results/detection/logs/train-log.csv
      md5: 870584cbeb118e8c2abcfc494bf7e8eb
      size: 1092
    - path: src/stages/generate-error-detection-report.py
      md5: 034f17bf8e2c5b63adfa0caab836fd69
      size: 2499
    - path: templates/report-error-detection.md
      md5: a6f392d6f73022cf9ef9b35dfa600b74
      size: 633
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
        data-split:
          val-size: 0.1
          train-split: data/splits/train.csv
          val-split: data/splits/val.csv
          test-split: data/splits/test.csv
        evaluate-error-detection:
          icdar-output-csv: results/detection/icdar_evaluation_results.csv
        predict-test-set-error-detection:
          per-device-eval-batch-size: 16
          test-log: results/detection/logs/test-log.csv
          predictions: results/detection/predictions.npy
        train-error-detection:
          pretrained-model-name: bert-base-multilingual-cased
          output-dir: models/error-detection/
          evaluation-strategy: epoch
          num-train-epochs: 3
          save-strategy: epoch
          per-device-train-batch-size: 16
          train-log: results/detection/logs/train-log.csv
    outs:
    - path: reports/detection/experiment_results.md
      md5: d2354144fdfe10c4db7ceb41e26ba507
      size: 1520
    - path: reports/detection/metrics.json
      md5: a0ffc36c50a661284c907e4a55d58f27
      size: 329
  convert-predictions-to-icdar-output:
    cmd: python src/stages/convert-predictions-to-icdar-output.py --config params.yaml
    deps:
    - path: data/processed/detection-dataset
      md5: 649d31b769a41e287af7e069efcf8f54.dir
      size: 77550059
      nfiles: 10
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: results/detection/predictions.npy
      md5: f3b134a9149b2205687ac3e13737d732
      size: 78632336
    - path: src/stages/convert-predictions-to-icdar-output.py
      md5: bf628478304b9fb7c3163f3425eef0bf
      size: 1958
    params:
      params.yaml:
        base:
          loglevel: INFO
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
        convert-predictions-to-icdar-output:
          icdar-output-json: results/detection/icdar_predictions.json
        predict-test-set-error-detection:
          per-device-eval-batch-size: 16
          test-log: results/detection/logs/test-log.csv
          predictions: results/detection/predictions.npy
        train-error-detection:
          pretrained-model-name: bert-base-multilingual-cased
          output-dir: models/error-detection/
          evaluation-strategy: epoch
          num-train-epochs: 3
          load-best-model-at-end: true
          save-strategy: epoch
          per-device-train-batch-size: 16
          train-log: results/detection/logs/train-log.csv
          delete-checkpoints: true
    outs:
    - path: results/detection/icdar_predictions.json
      md5: 1f1295ece1c46384f92aaa6fe1de2c7e
      size: 5172170
  create-error-correction-dataset:
    cmd: "python src/stages/create-error-correction-dataset.py --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip\
      \ --val-split data/splits/val.csv --context-offset 25 --dataset-out data/processed/correction-dataset/dataset.csv\
      \ --exclude-language\n"
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: data/splits/val.csv
      md5: 481d6c2885fa9f6aa7805c0100cb32e6
      size: 63904
    - path: src/stages/create-error-correction-dataset.py
      md5: 1172da68f13f29ce7b14bc87c5245fe3
      size: 2198
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        create-error-correction-dataset:
          context-offset: 25
          dataset: data/processed/correction-dataset/dataset.csv
        data-split:
          val-size: 0.1
          train-split: data/splits/train.csv
          val-split: data/splits/val.csv
          test-split: data/splits/test.csv
        error-correction-base:
          dev-mode: no-dev
          language-prefix: exclude-language
    outs:
    - path: data/processed/correction-dataset/dataset.csv
      md5: f619e420f2fa2b4304fbe877bb1ad28b
      size: 245604188
  train-error-correction:
    cmd: "python src/stages/train-error-correction.py --seed 8232 --dataset data/processed/correction-dataset/dataset.csv\
      \ --max-len 22 --model-name google/byt5-small --batch-size 16 --num-epochs 1\
      \ --valid-niter 5000 --model-dir models/error-correction-model --delete-checkpoints\
      \ --train-log results/correction/logs/train-log.csv --exclude-language --marker\
      \ mistake --no-dev\n"
    deps:
    - path: data/processed/correction-dataset/dataset.csv
      md5: f619e420f2fa2b4304fbe877bb1ad28b
      size: 245604188
    - path: src/stages/train-error-correction.py
      md5: a531d6d5024dc7c8eb28b5f9f8ad836e
      size: 3860
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        create-error-correction-dataset:
          context-offset: 25
          dataset: data/processed/correction-dataset/dataset.csv
        train-error-correction:
          max-len: 22
          batch-size: 16
          model-dir: models/error-correction-model
          num-epochs: 1
          valid-niter: 5000
          model-name: google/byt5-small
          train-log: results/correction/logs/train-log.csv
          add-task-prefix: no-add-task-prefix
          marker: mistake
    outs:
    - path: models/error-correction-model
      md5: 145e031703c37c2387bf2c450d96cd47.dir
      size: 1198644421
      nfiles: 7
    - path: results/correction/logs/train-log.csv
      md5: 42393c830c3567ddfbf1ad89ddf3d6ec
      size: 5009
  predict-error-correction:
    cmd: "python src/stages/predict-error-correction.py --error-correction-dataset\
      \ data/processed/correction-dataset/dataset.csv --hidden-size 256 --dropout\
      \ 0.1 --max-len 22 --teacher-forcing-ratio 0.5 --model-path models/error-correction/model.rar\
      \ --batch-size 256 --calculate-loss --test-log-file results/correction/logs/test-log.csv\
      \ --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip --perfect-detection-in\
      \ results/perfect/perfect-detection.json --perfect-detection-out results/correction/perfect-detection+predicted-correction.csv\
      \ --predicted-detection-in results/detection/icdar_predictions.json --predicted-detection-out\
      \ results/correction/predicted-detection+predicted-correction.csv\n"
    deps:
    - path: data/processed/correction-dataset/dataset.csv
      md5: be7a5f227615e26c71ca48d5d28c671e
      size: 85464285
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: results/detection/icdar_predictions.json
      md5: 1f1295ece1c46384f92aaa6fe1de2c7e
      size: 5172170
    - path: results/perfect/perfect-detection.json
      md5: 704ce11872db268fa8b8c340a512bff5
      size: 5197896
    - path: src/stages/predict-error-correction.py
      md5: 9f2ea04d9370c6c87c2bc0c9a33a251a
      size: 6809
    params:
      params.yaml:
        convert-error-detection-predictions-to-icdar-output:
          icdar-output-json: results/detection/icdar_predictions.json
        create-error-correction-dataset:
          dataset: data/processed/correction-dataset/dataset.csv
        generate-perfect-icdar-json:
          out-file-detection: results/perfect/perfect-detection.json
          out-file-correction: results/perfect/perfect-detection+correction.json
        predict-error-correction:
          test-log: results/correction/logs/test-log.csv
          perfect-detection-out: results/correction/perfect-detection+predicted-correction.csv
          predicted-detection-out: results/correction/predicted-detection+predicted-correction.csv
        train-error-correction:
          max-len: 22
          batch-size: 256
          model-save-path: models/error-correction/model.rar
          hidden-size: 256
          dropout: 0.1
          teacher-forcing-ratio: 0.5
          num-epochs: 25
          valid-niter: 1000
          max-num-patience: 5
          max-num-trial: 5
          lr-decay: 0.5
          train-log: results/correction/logs/train-log.csv
    outs:
    - path: results/correction/logs/test-log.csv
      md5: 2532e198a1e9296f1e57943aa274e1a6
      size: 31
    - path: results/correction/perfect-detection+predicted-correction.csv
      md5: c0ef37a65b3de52d8d6198f9e8d198ba
      size: 37252002
    - path: results/correction/predicted-detection+predicted-correction.csv
      md5: 385b0849a5045a1bb5e8c274b4b74397
      size: 36219207
  generate-perfect-icdar-json:
    cmd: "python src/stages/generate-perfect-icdar-json.py --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip\
      \ --out-file-detection results/perfect/perfect-detection.json --out-file-correction\
      \ results/perfect/perfect-detection+correction.json\n"
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: src/stages/generate-perfect-icdar-json.py
      md5: 89a3adbd23c7ff2df2d211426cc92685
      size: 2184
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        generate-perfect-icdar-json:
          out-file-detection: results/perfect/perfect-detection.json
          out-file-correction: results/perfect/perfect-detection+correction.json
    outs:
    - path: results/perfect/perfect-detection+correction.json
      md5: 1e4d292a1aef1894d1b584472a858277
      size: 11822558
    - path: results/perfect/perfect-detection.json
      md5: 81705463572854cb06fb5582a09f4fd3
      size: 5197896
  convert-perfect-correction-predicted-detection-results-to-icdar-format:
    cmd: "python src/stages/convert-error-correction-predictions-to-icdar-format.py\
      \ --predictions results/correction/perfect-detection+predicted-correction.csv\
      \ --icdar-json results/perfect/perfect-detection.json --out-file results/correction/perfect-detection+predicted-correction.json\n"
    deps:
    - path: results/correction/perfect-detection+predicted-correction.csv
      md5: 12187891b5122645b053e013e69e6163
      size: 37317334
    - path: results/perfect/perfect-detection.json
      md5: 81705463572854cb06fb5582a09f4fd3
      size: 5197896
    - path: src/stages/convert-error-correction-predictions-to-icdar-format.py
      md5: 54a3fd0875d525109c60bdbad289ddc8
      size: 631
    params:
      params.yaml:
        convert-perfect-correction-predicted-detection-results-to-icdar-format:
          out-file: results/correction/perfect-detection+predicted-correction.json
        generate-perfect-icdar-json:
          out-file-detection: results/perfect/perfect-detection.json
          out-file-correction: results/perfect/perfect-detection+correction.json
        predict-error-correction:
          batch-size: 128
          perfect-detection-out: results/correction/perfect-detection+predicted-correction.csv
          predicted-detection-out: results/correction/predicted-detection+predicted-correction.csv
    outs:
    - path: results/correction/perfect-detection+predicted-correction.json
      md5: a8901ca6baf5838487e7a7a3c47b44c2
      size: 11508308
  evaluate-error-correction-perfect-detection:
    cmd: "python src/stages/run-icdar-evaluation.py --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip\
      \ --json-file results/correction/perfect-detection+predicted-correction.json\
      \ --csv-file results/correction/icdar-evaluation-perfect-detection+predicted-correction.csv\n"
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: results/correction/perfect-detection+predicted-correction.json
      md5: a8901ca6baf5838487e7a7a3c47b44c2
      size: 11508308
    - path: src/stages/run-icdar-evaluation.py
      md5: 79deffa29b79f17f0ea4033a27a3a352
      size: 754
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        convert-error-detection-predictions-to-icdar-output:
          icdar-output-json: results/detection/icdar_predictions.json
        evaluate-error-correction-perfect-detection:
          icdar-output-csv: results/correction/icdar-evaluation-perfect-detection+predicted-correction.csv
    outs:
    - path: results/correction/icdar-evaluation-perfect-detection+predicted-correction.csv
      md5: 151c3b3725ab1b9140dc29df6ebe0975
      size: 158494
  convert-predicted-correction-predicted-detection-results-to-icdar-format:
    cmd: "python src/stages/convert-error-correction-predictions-to-icdar-format.py\
      \ --predictions results/correction/predicted-detection+predicted-correction.csv\
      \ --icdar-json results/detection/icdar_predictions.json --out-file results/correction/predicted-detection+predicted-correction.json\n"
    deps:
    - path: results/correction/predicted-detection+predicted-correction.csv
      md5: f9af83ff7f55a84e0ffe6983f1e53def
      size: 36332966
    - path: results/detection/icdar_predictions.json
      md5: 1f1295ece1c46384f92aaa6fe1de2c7e
      size: 5172170
    - path: src/stages/convert-error-correction-predictions-to-icdar-format.py
      md5: 54a3fd0875d525109c60bdbad289ddc8
      size: 631
    params:
      params.yaml:
        convert-error-detection-predictions-to-icdar-output:
          icdar-output-json: results/detection/icdar_predictions.json
        convert-predicted-correction-predicted-detection-results-to-icdar-format:
          out-file: results/correction/predicted-detection+predicted-correction.json
        predict-error-correction:
          batch-size: 128
          perfect-detection-out: results/correction/perfect-detection+predicted-correction.csv
          predicted-detection-out: results/correction/predicted-detection+predicted-correction.csv
    outs:
    - path: results/correction/predicted-detection+predicted-correction.json
      md5: e7cd1de227fd9502803972257049d700
      size: 11317764
  evaluate-error-correction-predicted-detection:
    cmd: "python src/stages/run-icdar-evaluation.py --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip\
      \ --json-file results/correction/predicted-detection+predicted-correction.json\
      \ --csv-file results/correction/icdar-evaluation-predicted-detection+predicted-correction.csv\n"
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: results/correction/predicted-detection+predicted-correction.json
      md5: e7cd1de227fd9502803972257049d700
      size: 11317764
    - path: src/stages/run-icdar-evaluation.py
      md5: 79deffa29b79f17f0ea4033a27a3a352
      size: 754
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        convert-error-detection-predictions-to-icdar-output:
          icdar-output-json: results/detection/icdar_predictions.json
        evaluate-error-correction-predicted-detection:
          icdar-output-csv: results/correction/icdar-evaluation-predicted-detection+predicted-correction.csv
    outs:
    - path: results/correction/icdar-evaluation-predicted-detection+predicted-correction.csv
      md5: fdfe4186b821d5fe8899d7033ad8cfb3
      size: 158502
  generate-error-correction-report:
    cmd: "python src/stages/generate-error-correction-report.py --train-log results/correction/logs/train-log.csv\
      \ --test-log results/correction/logs/test-log.csv --eval-perfect-detection results/correction/icdar-evaluation-perfect-detection+predicted-correction.csv\
      \ --eval-predicted-detection results/correction/icdar-evaluation-predicted-detection+predicted-correction.csv\
      \ --metrics-file reports/correction/metrics.json --seed 8232 --val-size 0.1\
      \ --max-len 22 --report-file reports/correction/experiment_results.md --model-name\
      \ google/byt5-small --num-epochs 1\n"
    deps:
    - path: results/correction/icdar-evaluation-perfect-detection+predicted-correction.csv
      md5: 151c3b3725ab1b9140dc29df6ebe0975
      size: 158494
    - path: results/correction/icdar-evaluation-predicted-detection+predicted-correction.csv
      md5: fdfe4186b821d5fe8899d7033ad8cfb3
      size: 158502
    - path: results/correction/logs/test-log.csv
      md5: 601b4d1e213b9ebada395ef4571ed454
      size: 115
    - path: results/correction/logs/train-log.csv
      md5: 85dc54e1762afcb613d0688f68e6a2d0
      size: 3102
    - path: src/stages/generate-error-correction-report.py
      md5: 79a2c67b8ad8cdb1019ff377cb652693
      size: 3432
    - path: templates/report-error-correction.md
      md5: 6ff9e3d5e291805f95e6422ace484208
      size: 821
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        create-error-detection-dataset:
          size: 35
          step: 30
          max-edit-distance: 0.3
          dataset: data/processed/detection-dataset
        data-split:
          val-size: 0.1
          train-split: data/splits/train.csv
          val-split: data/splits/val.csv
          test-split: data/splits/test.csv
        evaluate-error-correction-perfect-detection:
          icdar-output-csv: results/correction/icdar-evaluation-perfect-detection+predicted-correction.csv
        evaluate-error-correction-predicted-detection:
          icdar-output-csv: results/correction/icdar-evaluation-predicted-detection+predicted-correction.csv
        generate-error-correction-report:
          metrics: reports/correction/metrics.json
          report-file: reports/correction/experiment_results.md
        predict-error-correction:
          batch-size: 128
          perfect-detection-out: results/correction/perfect-detection+predicted-correction.csv
          predicted-detection-out: results/correction/predicted-detection+predicted-correction.csv
        train-error-correction:
          max-len: 22
          batch-size: 16
          model-dir: models/error-correction-model
          num-epochs: 1
          valid-niter: 5000
          model-name: google/byt5-small
          train-log: results/correction/logs/train-log.csv
          add-task-prefix: add-task-prefix
    outs:
    - path: reports/correction/experiment_results.md
      md5: 325efa59cc6b4eda335cf85c9aa3d819
      size: 1245
    - path: reports/correction/metrics.json
      md5: 8177d95889218e194ae35e19709043ec
      size: 1176
  convert-error-detection-predictions-to-icdar-output:
    cmd: "python src/stages/convert-error-detection-predictions-to-icdar-output.py\
      \ --dataset-in data/processed/detection-dataset --model-name bert-base-multilingual-cased\
      \ --predictions-in results/detection/predictions.npy --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip\
      \ --json-out results/detection/icdar_predictions.json\n"
    deps:
    - path: data/processed/detection-dataset
      md5: 649d31b769a41e287af7e069efcf8f54.dir
      size: 77550059
      nfiles: 10
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: results/detection/predictions.npy
      md5: f3b134a9149b2205687ac3e13737d732
      size: 78632336
    - path: src/stages/convert-error-detection-predictions-to-icdar-output.py
      md5: 0998a0eddb1ff1b3bc3aee88398988c7
      size: 1757
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        convert-error-detection-predictions-to-icdar-output:
          icdar-output-json: results/detection/icdar_predictions.json
        predict-test-set-error-detection:
          per-device-eval-batch-size: 16
          test-log: results/detection/logs/test-log.csv
          predictions: results/detection/predictions.npy
        train-error-detection:
          pretrained-model-name: bert-base-multilingual-cased
          output-dir: models/error-detection/
          evaluation-strategy: epoch
          num-train-epochs: 3
          save-strategy: epoch
          per-device-train-batch-size: 16
          train-log: results/detection/logs/train-log.csv
    outs:
    - path: results/detection/icdar_predictions.json
      md5: 1f1295ece1c46384f92aaa6fe1de2c7e
      size: 5172170
  calculate-loss-error-correction:
    cmd: "python src/stages/calculate-loss-error-correction.py --error-correction-dataset\
      \ data/processed/correction-dataset/dataset.csv --max-len 22 --model-name models/error-correction-model\
      \ --test-log-file results/correction/logs/test-log.csv --seed 8232 --batch-size\
      \ 128 --include-language --no-dev\n"
    deps:
    - path: data/processed/correction-dataset/dataset.csv
      md5: 66bbccf19b57c452fa66740971882c60
      size: 102693229
    - path: models/error-correction-model
      md5: 6eeb8e5f39b88eda93f0beb69b68e0c8.dir
      size: 1198620825
      nfiles: 6
    - path: src/stages/calculate-loss-error-correction.py
      md5: d3785c94659828dd4be052c890ec1db9
      size: 2367
    params:
      params.yaml:
        calculate-loss-error-correction:
          batch-size: 128
          test-log: results/correction/logs/test-log.csv
        create-error-correction-dataset:
          dataset: data/processed/correction-dataset/dataset.csv
        error-correction-base:
          dev-mode: no-dev
          language-prefix: include-language
        train-error-correction:
          max-len: 22
          batch-size: 16
          model-dir: models/error-correction-model
          num-epochs: 1
          valid-niter: 5000
          model-name: google/byt5-small
          train-log: results/correction/logs/train-log.csv
          add-task-prefix: add-task-prefix
    outs:
    - path: results/correction/logs/test-log.csv
      md5: 601b4d1e213b9ebada395ef4571ed454
      size: 115
  predict-error-correction-perfect-detection:
    cmd: "python src/stages/predict-error-correction.py --max-len 22 --model-name\
      \ models/error-correction-model --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip\
      \ --seed 8232 --batch-size 128 --perfect-detection-in results/perfect/perfect-detection.json\
      \ --perfect-detection-out results/correction/perfect-detection+predicted-correction.csv\
      \ --include-language --no-dev\n"
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: models/error-correction-model
      md5: 6eeb8e5f39b88eda93f0beb69b68e0c8.dir
      size: 1198620825
      nfiles: 6
    - path: results/perfect/perfect-detection.json
      md5: 81705463572854cb06fb5582a09f4fd3
      size: 5197896
    - path: src/stages/predict-error-correction.py
      md5: 657f0481eff2235c8f4964c7505295f5
      size: 5219
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        error-correction-base:
          dev-mode: no-dev
          language-prefix: include-language
        generate-perfect-icdar-json:
          out-file-detection: results/perfect/perfect-detection.json
          out-file-correction: results/perfect/perfect-detection+correction.json
        predict-error-correction:
          batch-size: 128
          perfect-detection-out: results/correction/perfect-detection+predicted-correction.csv
          predicted-detection-out: results/correction/predicted-detection+predicted-correction.csv
        train-error-correction:
          max-len: 22
          batch-size: 16
          model-dir: models/error-correction-model
          num-epochs: 1
          valid-niter: 5000
          model-name: google/byt5-small
          train-log: results/correction/logs/train-log.csv
          add-task-prefix: add-task-prefix
    outs:
    - path: results/correction/perfect-detection+predicted-correction.csv
      md5: 12187891b5122645b053e013e69e6163
      size: 37317334
  predict-error-correction-predicted-detection:
    cmd: "python src/stages/predict-error-correction.py --max-len 22 --model-name\
      \ models/error-correction-model --raw-dataset data/raw/ICDAR2019_POCR_competition_dataset.zip\
      \ --seed 8232 --batch-size 128 --predicted-detection-in results/detection/icdar_predictions.json\
      \ --predicted-detection-out results/correction/predicted-detection+predicted-correction.csv\
      \ --include-language --no-dev\n"
    deps:
    - path: data/raw/ICDAR2019_POCR_competition_dataset.zip
      md5: 12de784f02a0dd99d1b3997674ee97f4
      size: 66523152
    - path: models/error-correction-model
      md5: 6eeb8e5f39b88eda93f0beb69b68e0c8.dir
      size: 1198620825
      nfiles: 6
    - path: results/detection/icdar_predictions.json
      md5: 1f1295ece1c46384f92aaa6fe1de2c7e
      size: 5172170
    - path: src/stages/predict-error-correction.py
      md5: 657f0481eff2235c8f4964c7505295f5
      size: 5219
    params:
      params.yaml:
        base:
          seed: 8232
          raw-data-zip: data/raw/ICDAR2019_POCR_competition_dataset.zip
          dev-mode: no-dev
        convert-error-detection-predictions-to-icdar-output:
          icdar-output-json: results/detection/icdar_predictions.json
        error-correction-base:
          dev-mode: no-dev
          language-prefix: include-language
        predict-error-correction:
          batch-size: 128
          perfect-detection-out: results/correction/perfect-detection+predicted-correction.csv
          predicted-detection-out: results/correction/predicted-detection+predicted-correction.csv
        train-error-correction:
          max-len: 22
          batch-size: 16
          model-dir: models/error-correction-model
          num-epochs: 1
          valid-niter: 5000
          model-name: google/byt5-small
          train-log: results/correction/logs/train-log.csv
          add-task-prefix: add-task-prefix
    outs:
    - path: results/correction/predicted-detection+predicted-correction.csv
      md5: f9af83ff7f55a84e0ffe6983f1e53def
      size: 36332966
